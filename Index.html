<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù„ÙŠØ±Ø© - Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª</title>
    <!-- Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- React & Tailwind (ØªØ³ØªØ®Ø¯Ù… Ù…Ù† CDNØŒ ÙÙŠ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ÙŠÙØ¶Ù„ ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ù…Ø­Ù„ÙŠØ§Ù‹) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--tg-theme-bg-color, #f8fafc); color: var(--tg-theme-text-color, #1e293b); margin: 0; padding: 0; }
        .tg-card { background-color: var(--tg-theme-secondary-bg-color, #ffffff); }
        .tg-button { background-color: var(--tg-theme-button-color, #4f46e5); color: var(--tg-theme-button-text-color, #ffffff); }
        /* Ø§Ø³ØªØ§ÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„ */
        .offline-badge { background: #ef4444; color: white; text-align: center; font-size: 10px; padding: 2px; display: none; }
        body.is-offline .offline-badge { display: block; }
    </style>
</head>
<body>
    <div class="offline-badge">Ø£Ù†Øª ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹)</div>
    <div id="root"></div>

    <!-- Service Worker Script Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª -->
    <script>
        const CACHE_NAME = 'lira-guide-v1';
        const ASSETS = [
            window.location.href,
            'https://telegram.org/js/telegram-web-app.js',
            'https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap'
        ];

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = '${CACHE_NAME}';
                    self.addEventListener('install', e => {
                        e.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(['./'])));
                    });
                    self.addEventListener('fetch', e => {
                        e.respondWith(caches.match(e.request).then(res => res || fetch(e.request)));
                    });
                `;
                const blob = new Blob([swCode], { type: 'text/javascript' });
                navigator.serviceWorker.register(URL.createObjectURL(blob));
            });
        }

        window.addEventListener('offline', () => document.body.classList.add('is-offline'));
        window.addEventListener('online', () => document.body.classList.remove('is-offline'));
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const RATE = 100;
        const DENOMS = [
            { v: 500, n: 'Ø³Ù†Ø§Ø¨Ù„ Ø§Ù„Ù‚Ù…Ø­', s: 'ğŸŒ¾' },
            { v: 200, n: 'Ø£ØºØµØ§Ù† Ø§Ù„Ø²ÙŠØªÙˆÙ†', s: 'ğŸ«’' },
            { v: 100, n: 'Ø§Ù„Ù‚Ø·Ù† Ø§Ù„Ø³ÙˆØ±ÙŠ', s: 'â˜ï¸' },
            { v: 50, n: 'Ø§Ù„Ø­Ù…Ø¶ÙŠØ§Øª', s: 'ğŸŠ' },
            { v: 25, n: 'Ø§Ù„Ø¹Ù†Ø¨', s: 'ğŸ‡' },
            { v: 10, n: 'ÙŠØ§Ø³Ù…ÙŠÙ† Ø§Ù„Ø´Ø§Ù…', s: 'ğŸŒ¼' }
        ];

        function App() {
            const [val, setVal] = useState('');
            const [isOldToNew, setIsOldToNew] = useState(true);
            const [parts, setParts] = useState([]);
            const [leftover, setLeftover] = useState(0);

            useEffect(() => {
                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
            }, []);

            const cleanNum = (str) => {
                const map = { "Ù ":"0","Ù¡":"1","Ù¢":"2","Ù£":"3","Ù¤":"4","Ù¥":"5","Ù¦":"6","Ù§":"7","Ù¨":"8","Ù©":"9" };
                return str.replace(/[Ù -Ù©]/g, d => map[d] || d);
            };

            const numVal = parseFloat(cleanNum(val)) || 0;
            const currentResult = isOldToNew ? (numVal / RATE) : (numVal * RATE);
            const amountInNew = isOldToNew ? currentResult : numVal;

            useEffect(() => {
                let current = amountInNew;
                const res = [];
                if (current > 0) {
                    DENOMS.forEach(d => {
                        const count = Math.floor(current / d.v);
                        if (count > 0) {
                            res.push({ ...d, count });
                            current = Math.round((current - (count * d.v)) * 100) / 100;
                        }
                    });
                }
                setParts(res);
                setLeftover(current);
            }, [amountInNew]);

            return (
                <div className="min-h-screen p-4 pb-10 space-y-4">
                    <div className="flex items-center justify-between py-2">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white font-black shadow-lg">Ø¯</div>
                            <h1 className="text-lg font-black">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù„ÙŠØ±Ø©</h1>
                        </div>
                        <button onClick={() => setVal('')} className="p-2 opacity-30 text-xs font-bold uppercase">Ù…Ø³Ø­</button>
                    </div>

                    <div className="flex p-1 bg-black/5 rounded-2xl">
                        <button onClick={() => setIsOldToNew(true)} className={`flex-1 py-2.5 rounded-xl text-xs font-bold transition-all ${isOldToNew ? 'bg-white shadow text-indigo-600' : 'opacity-40'}`}>Ù‚Ø¯ÙŠÙ… â† Ø¬Ø¯ÙŠØ¯</button>
                        <button onClick={() => setIsOldToNew(false)} className={`flex-1 py-2.5 rounded-xl text-xs font-bold transition-all ${!isOldToNew ? 'bg-white shadow text-indigo-600' : 'opacity-40'}`}>Ø¬Ø¯ÙŠØ¯ â† Ù‚Ø¯ÙŠÙ…</button>
                    </div>

                    <div className="tg-card rounded-3xl p-6 border border-black/5">
                        <div className="text-[10px] font-black opacity-30 mb-2 uppercase tracking-widest">Ø§Ù„Ù…Ø¨Ù„Øº ({isOldToNew ? 'Ù‚Ø¯ÙŠÙ…' : 'Ø¬Ø¯ÙŠØ¯'})</div>
                        <input 
                            type="text" 
                            inputMode="decimal"
                            value={val}
                            onChange={(e) => setVal(e.target.value)}
                            placeholder="0.00"
                            className="w-full text-5xl font-black bg-transparent outline-none mb-6"
                        />
                        <div className="pt-6 border-t border-black/5 flex justify-between items-end">
                            <div>
                                <div className="text-[10px] font-black opacity-30 uppercase">Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ ({!isOldToNew ? 'Ù‚Ø¯ÙŠÙ…' : 'Ø¬Ø¯ÙŠØ¯'})</div>
                                <div className="text-3xl font-black text-indigo-500">{currentResult.toLocaleString('ar-SY')}</div>
                            </div>
                        </div>
                    </div>

                    <div className="space-y-2">
                        <h2 className="text-[10px] font-black opacity-30 px-2 uppercase tracking-widest">ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</h2>
                        {parts.map(p => (
                            <div key={p.v} className="tg-card p-4 rounded-2xl flex items-center justify-between border border-black/5">
                                <div className="flex items-center gap-3">
                                    <span className="text-2xl">{p.s}</span>
                                    <span className="font-black text-lg">{p.v}</span>
                                </div>
                                <div className="tg-button px-4 py-1.5 rounded-lg font-black text-lg">Ã—{p.count}</div>
                            </div>
                        ))}
                    </div>

                    {leftover > 0 && (
                        <div className="p-4 bg-amber-50 rounded-2xl border border-amber-200 text-amber-900 text-xs font-bold leading-relaxed">
                            âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¨Ù‚ÙŠ {leftover} Ù„ÙŠØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŒ ØªØ¯ÙØ¹Ù‡Ø§ Ø¨Ù‚ÙŠÙ…Ø© {Math.round(leftover * 100)} Ù„.Ø³ Ù‚Ø¯ÙŠÙ…Ø©.
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
