
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù„ÙŠØ±Ø© - Mini App</title>
    
    <!-- Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- React & Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        * { 
            font-family: 'Cairo', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
        }
        body { 
            background-color: var(--tg-theme-bg-color, #f8fafc); 
            color: var(--tg-theme-text-color, #1e293b); 
            margin: 0; 
            padding: 0;
            overflow-x: hidden;
        }
        .tg-card { 
            background-color: var(--tg-theme-secondary-bg-color, #ffffff); 
            border-color: var(--tg-theme-hint-color, rgba(0,0,0,0.05));
        }
        .tg-button { 
            background-color: var(--tg-theme-button-color, #4f46e5); 
            color: var(--tg-theme-button-text-color, #ffffff); 
        }
        .tg-hint {
            color: var(--tg-theme-hint-color, #94a3b8);
        }
        .tg-link {
            color: var(--tg-theme-link-color, #4f46e5);
        }
        /* Offline Style */
        .offline-badge { 
            background: #ef4444; 
            color: white; 
            text-align: center; 
            font-size: 11px; 
            padding: 4px; 
            display: none; 
            position: sticky;
            top: 0;
            z-index: 50;
        }
        body.is-offline .offline-badge { display: block; }
        
        input::placeholder {
            color: var(--tg-theme-hint-color, #cbd5e1);
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="offline-badge">Ø£Ù†Øª ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª</div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const RATE = 100;
        const DENOMS = [
            { v: 500, n: 'Ø³Ù†Ø§Ø¨Ù„ Ø§Ù„Ù‚Ù…Ø­', s: 'ğŸŒ¾' },
            { v: 200, n: 'Ø£ØºØµØ§Ù† Ø§Ù„Ø²ÙŠØªÙˆÙ†', s: 'ğŸ«’' },
            { v: 100, n: 'Ø§Ù„Ù‚Ø·Ù† Ø§Ù„Ø³ÙˆØ±ÙŠ', s: 'â˜ï¸' },
            { v: 50, n: 'Ø§Ù„Ø­Ù…Ø¶ÙŠØ§Øª', s: 'ğŸŠ' },
            { v: 25, n: 'Ø§Ù„Ø¹Ù†Ø¨', s: 'ğŸ‡' },
            { v: 10, n: 'ÙŠØ§Ø³Ù…ÙŠÙ† Ø§Ù„Ø´Ø§Ù…', s: 'ğŸŒ¼' }
        ];

        function App() {
            const [val, setVal] = useState('');
            const [isOldToNew, setIsOldToNew] = useState(true);
            const tg = window.Telegram.WebApp;

            useEffect(() => {
                tg.ready();
                tg.expand();
                // ØªØ¹ÙŠÙŠÙ† Ù„ÙˆÙ† Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø«ÙŠÙ…
                tg.setHeaderColor('secondary_bg_color');
            }, []);

            const cleanNum = (str) => {
                const map = { "Ù ":"0","Ù¡":"1","Ù¢":"2","Ù£":"3","Ù¤":"4","Ù¥":"5","Ù¦":"6","Ù§":"7","Ù¨":"8","Ù©":"9" };
                return str.replace(/[Ù -Ù©]/g, d => map[d] || d).replace(/[^0-9.]/g, '');
            };

            const handleModeChange = (mode) => {
                if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
                setIsOldToNew(mode);
            };

            const numVal = parseFloat(cleanNum(val)) || 0;
            const currentResult = isOldToNew ? (numVal / RATE) : (numVal * RATE);

            // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆØ²ÙŠØ¹
            const { parts, leftover } = useMemo(() => {
                let current = isOldToNew ? Math.floor(currentResult) : currentResult;
                const res = [];
                let rem = 0;

                if (isOldToNew) {
                    // Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    DENOMS.forEach(d => {
                        const count = Math.floor(current / d.v);
                        if (count > 0) {
                            res.push({ ...d, count });
                            current -= (count * d.v);
                        }
                    });
                    // Ø§Ù„ÙØ±Ø§Ø·Ø© Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…
                    rem = Math.round((current * RATE) + (numVal % RATE));
                } else {
                    // Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·ØŒ Ø¹Ø§Ø¯Ø© Ù†Ø³ØªØ®Ø¯Ù… ÙØ¦Ø§Øª Ø§Ù„Ù€ 5000 ÙˆØ§Ù„Ù€ 2000)
                    const OLD_DENOMS = [5000, 2000, 1000, 500, 200, 100, 50];
                    let currentOld = currentResult;
                    OLD_DENOMS.forEach(v => {
                        const count = Math.floor(currentOld / v);
                        if (count > 0) {
                            res.push({ v, n: 'ÙØ¦Ø© Ù‚Ø¯ÙŠÙ…Ø©', s: 'ğŸ’´', count });
                            currentOld -= (count * v);
                        }
                    });
                    rem = Math.round(currentOld);
                }
                
                return { parts: res, leftover: rem };
            }, [numVal, isOldToNew, currentResult]);

            return (
                <div className="min-h-screen p-4 pb-12 space-y-4">
                    {/* Header */}
                    <div className="flex items-center justify-between py-2">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 tg-button rounded-2xl flex items-center justify-center text-white font-black shadow-lg shadow-indigo-500/20">
                                Ù„
                            </div>
                            <div>
                                <h1 className="text-lg font-black leading-none">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù„ÙŠØ±Ø©</h1>
                                <span className="text-[10px] font-bold tg-hint">Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</span>
                            </div>
                        </div>
                        <button 
                            onClick={() => {
                                setVal('');
                                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                            }} 
                            className="p-2 tg-hint text-xs font-bold uppercase active:scale-95 transition-transform"
                        >
                            Ù…Ø³Ø­
                        </button>
                    </div>

                    {/* Switcher */}
                    <div className="flex p-1 tg-card rounded-2xl border">
                        <button 
                            onClick={() => handleModeChange(true)} 
                            className={`flex-1 py-2.5 rounded-xl text-xs font-black transition-all ${isOldToNew ? 'bg-indigo-600 text-white shadow-md' : 'tg-hint'}`}
                        >
                            Ù‚Ø¯ÙŠÙ… â† Ø¬Ø¯ÙŠØ¯
                        </button>
                        <button 
                            onClick={() => handleModeChange(false)} 
                            className={`flex-1 py-2.5 rounded-xl text-xs font-black transition-all ${!isOldToNew ? 'bg-indigo-600 text-white shadow-md' : 'tg-hint'}`}
                        >
                            Ø¬Ø¯ÙŠØ¯ â† Ù‚Ø¯ÙŠÙ…
                        </button>
                    </div>

                    {/* Input Card */}
                    <div className="tg-card rounded-3xl p-6 border shadow-sm">
                        <div className="text-[10px] font-black tg-hint mb-2 uppercase tracking-widest">
                            Ø§Ù„Ù…Ø¨Ù„Øº ({isOldToNew ? 'Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…' : 'Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯'})
                        </div>
                        <input 
                            type="text" 
                            inputMode="decimal"
                            value={val}
                            onChange={(e) => setVal(e.target.value)}
                            placeholder="0.00"
                            className="w-full text-5xl font-black bg-transparent outline-none mb-6 border-none focus:ring-0"
                        />
                        <div className="pt-6 border-t tg-card border-dashed flex justify-between items-end">
                            <div>
                                <div className="text-[10px] font-black tg-hint uppercase">Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ ({!isOldToNew ? 'Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…' : 'Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯'})</div>
                                <div className="text-3xl font-black tg-link">
                                    {currentResult.toLocaleString('en-US', { maximumFractionDigits: 2 })}
                                </div>
                            </div>
                            <div className="text-xs font-bold tg-hint">
                                {isOldToNew ? 'Ù„ÙŠØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©' : 'Ù„ÙŠØ±Ø© Ù‚Ø¯ÙŠÙ…Ø©'}
                            </div>
                        </div>
                    </div>

                    {/* Distribution List */}
                    <div className="space-y-2">
                        <h2 className="text-[10px] font-black tg-hint px-2 uppercase tracking-widest">ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</h2>
                        {parts.length === 0 && (
                            <div className="text-center py-8 tg-hint text-sm font-bold opacity-50">
                                Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„ØºØ§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ²ÙŠØ¹
                            </div>
                        )}
                        {parts.map((p, idx) => (
                            <div key={idx} className="tg-card p-4 rounded-2xl flex items-center justify-between border shadow-sm active:scale-[0.98] transition-transform">
                                <div className="flex items-center gap-3">
                                    <span className="text-2xl">{p.s}</span>
                                    <div>
                                        <div className="font-black text-lg leading-none">{p.v.toLocaleString()}</div>
                                        <div className="text-[10px] font-bold tg-hint">{p.n}</div>
                                    </div>
                                </div>
                                <div className="tg-button px-4 py-1.5 rounded-xl font-black text-lg shadow-sm">
                                    Ã—{p.count}
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Change / Leftover */}
                    {leftover > 0 && (
                        <div className="p-4 bg-amber-500/10 rounded-2xl border border-amber-500/20 text-amber-600 dark:text-amber-400 text-xs font-bold leading-relaxed flex gap-3">
                            <span className="text-lg">âš ï¸</span>
                            <div>
                                {isOldToNew ? (
                                    <span>Ø¨Ù‚ÙŠ <b>{leftover}</b> Ù„ÙŠØ±Ø© Ù‚Ø¯ÙŠÙ…Ø© ØªØ¯ÙØ¹ ÙƒÙÙƒØ© (Ù„Ø£Ù†Ù‡Ø§ Ù„Ù… ØªÙƒØªÙ…Ù„ Ù„ÙŠØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©).</span>
                                ) : (
                                    <span>Ø¨Ù‚ÙŠ <b>{leftover}</b> Ù„ÙŠØ±Ø© Ù‚Ø¯ÙŠÙ…Ø© (ØªØ¹Ø§Ø¯Ù„ { (leftover/RATE).toFixed(2) } Ù…Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯).</span>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // Offline logic
        window.addEventListener('offline', () => document.body.classList.add('is-offline'));
        window.addEventListener('online', () => document.body.classList.remove('is-offline'));
    </script>
</body>
</html>
